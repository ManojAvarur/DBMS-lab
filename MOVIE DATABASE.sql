CREATE DATABASE MOVIE_DATABASE;

USE MOVIE_DATABASE;

CREATE TABLE ACTOR (
 ACT_ID INT,
 ACT_NAME VARCHAR(20),
 ACT_GENDER CHAR(1),
 PRIMARY KEY(ACT_ID)
);

CREATE TABLE DIRECTOR (
 DIR_ID INT,
 DIR_NAME VARCHAR(20),
 DIR_PHONE INT(10),
 PRIMARY KEY(DIR_ID)
);

CREATE TABLE MOVIES (
 MOV_ID INT,
 MOV_TITLE VARCHAR(25),
 MOV_YEAR YEAR,
 MOV_LANG VARCHAR(12),
 DIR_ID INT,
 PRIMARY KEY(MOV_ID),
 FOREIGN KEY(DIR_ID) REFERENCES DIRECTOR(DIR_ID)
);

CREATE TABLE MOVIE_CAST (
 ACT_ID INT,
 MOV_ID INT,
 ROLE VARCHAR(10),
 PRIMARY KEY(ACT_ID,MOV_ID),
 FOREIGN KEY(ACT_ID) REFERENCES ACTOR(ACT_ID),
 FOREIGN KEY(MOV_ID) REFERENCES MOVIES(MOV_ID) );

CREATE TABLE RATING (
 MOV_ID INT,
 REV_STARS VARCHAR(25),
 PRIMARY KEY(MOV_ID),
 FOREIGN KEY(MOV_ID) REFERENCES MOVIES(MOV_ID)
);
 
INSERT INTO ACTOR VALUES (301,'ANUSHKA','F');
INSERT INTO ACTOR VALUES (302,'PRABHAS','M');
INSERT INTO ACTOR VALUES (303,'PUUNITH','M');
INSERT INTO ACTOR VALUES (304,'JERMY','M');

INSERT INTO DIRECTOR VALUES (60,'RAJAMOULI',854752364);
INSERT INTO DIRECTOR VALUES (61,'HITCHCOCK',123548952);
INSERT INTO DIRECTOR VALUES (62,'FAREN',214597512);
INSERT INTO DIRECTOR VALUES (63,'STEVEN SPLIELBREG',865487521);

INSERT INTO MOVIES VALUES (1001,'BHAHUBALLI-2',2017,'TELAGU',60);
INSERT INTO MOVIES VALUES (1002,'BHAHUBALLI-1',2015,'TELAGU',60);
INSERT INTO MOVIES VALUES (1003,'AKASH',2008,'KANNADA',61);
INSERT INTO MOVIES VALUES (1004,'WAR HORSE',2011,'EMGLISH',63);

INSERT INTO MOVIE_CAST VALUES (301,1002,'HEROINE');
INSERT INTO MOVIE_CAST VALUES (302,1001,'HEROINE');
INSERT INTO MOVIE_CAST VALUES (303,1003,'HERO');
INSERT INTO MOVIE_CAST VALUES (303,1002,'GUEST'); 
INSERT INTO MOVIE_CAST VALUES (304,1004,'HERO');

INSERT INTO RATING VALUES (1001,4);
INSERT INTO RATING VALUES (1002,2);
INSERT INTO RATING VALUES (1003,5);
INSERT INTO RATING VALUES (1004,4);


-- QUERIES 

-- 1>  List the titles of all movies directed by ‘Hitchcock’.

SELECT M.MOV_TITLE
    FROM MOVIES M, DIRECTOR D
        WHERE M.DIR_ID = D.DIR_ID AND
            D.DIR_NAME = 'Hitchcock';

-- 2>   Find the movie names where one or more actors acted in two or more movies.

SELECT M.MOV_TITLE
    FROM MOVIES M, MOVIE_CAST MC
        WHERE MC.MOV_ID = M.MOV_ID
            GROUP BY MC.ACT_ID
                HAVING COUNT(ACT_ID) > 1;


SELECT MOV_TITLE
    FROM MOVIES M, MOVIE_CAST MV
        WHERE M.MOV_ID = MV.MOV_ID AND 
            ACT_ID IN ( SELECT ACT_ID
  						    FROM MOVIE_CAST 
                                GROUP BY ACT_ID 
                                    HAVING ACT_ID > 1)
                GROUP BY MOV_TITLE HAVING
  					COUNT(*) > 1;


-- 3>   List all actors who acted in a movie before 2000 and also in a movie after
--     2015 (use JOIN operation).

SELECT A.ACT_NAME, A.ACT_GENDER
    FROM ACTOR A, MOVIES M, MOVIE_CAST MC
        WHERE MC.ACT_ID = A.ACT_ID AND
            MC.MOV_ID = M.MOV_ID AND
            M.MOV_YEAR NOT BETWEEN 2000 AND 2015;


SELECT ACT_NAME, MOV_TITLE, MOV_YEAR
    FROM ACTOR A
        JOIN MOVIE_CAST MC 
            ON A.ACT_ID = MC.ACT_ID
        JOIN MOVIES M 
            ON MC.MOV_ID = M.MOV_ID
                WHERE M.MOV_YEAR NOT BETWEEN 2000 AND 2015;

    
-- 4>   Find the title of movies and number of stars for each movie that has at least one
--  rating and find the highest number of stars that movie received. Sort the result by
--  movie title.

SELECT MOV_TITLE, MAX(REV_STARS) AS MAXIMUM_STARS
    FROM MOVIES M, RATING R 
        WHERE M.MOV_ID = R.MOV_ID
            GROUP BY MOV_TITLE
                HAVING MAX(REV_STARS) > 0
                    ORDER BY MOV_TITLE;

-- 5>   Update rating of all movies directed by ‘Steven Spielberg’ to 5.

UPDATE RATING
    SET REV_STARS = 5
        WHERE MOV_ID = (SELECT MOV_ID 
                            FROM MOVIES
                                WHERE DIR_ID = (SELECT DIR_ID 
                                                    FROM DIRECTOR
                                                        WHERE DIR_NAME = 'STEVEN SPLIELBREG'));